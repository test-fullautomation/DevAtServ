#!/bin/bash

source /opt/devatserv/bin/start-devatserv.sh

# Service name
service="devatserv"

display_commands() {
    echo "Commands:"
    echo "  start       Starting all "
    echo "  stop        Stop all containers of DevAtServ"
    echo "  restart     Restart all containers of DevAtServ"
    echo "  load        Load all images of DevAtSev"
    echo "  remove        Remove all containers, volumns of DevAtSev"
}

display_options() {
    echo "Options:"
    echo "  -f, --config-file   <config_file>   Input a specified config file"
    echo "  -i, --install       <config_file>   Install services using specified config file"
    echo "  -c, --clone                         Clone and update services"
    echo "  -s, --start                         Build and start Docker Compose services"
    echo "  -a, --archive                       Archive all services"
    echo "  -h, --help                          Show this help message"
}

# Function to show help with both commands and global options
show_help() {
  echo "Usage: $0 [command]"
  echo
  display_commands
  echo
  display_options
}

# Parse command-line arguments
if [ $# -eq 0 ]; then
  show_help
else
  case $1 in
      start) 
        start_devatserv
        ;;
      stop) 
        stop_devatserv
        ;;
      restart)
        restart_devatserv
        ;;
      load)
        load_devatserv
        ;;
      -i|--install) # Install services
          config_file="$2"
          if [[ -z "$config_file" ]]; then
              echo "Error: Missing config file for install option"
              show_help
              exit 1
          fi
          main $config_file
          shift 2
          ;;
      -c|--clone) # Clone services
          install_services || {
              echo 'Error cloning service' 
              exit 1
          }
          shift 
          ;;
      -s|--start) # Start Docker Compose services
          start_docker_compose || {
              echo 'Error starting Docker' 
              exit 1
          }
          shift
          ;;
      -a|--archive) # Archive all services
          archive_all_services || {
              echo 'Error archiving services' 
              exit 1
          }
          shift
          ;;
      -h|--help) # Show help
          show_help
          exit 0
          ;;
      *) # Unknown option
          echo "Error: Invalid option $1"
          show_help
          exit 1
          ;;
  esac
fi